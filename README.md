# dazhongdianping
python，大众点评的爬虫，突破反爬，获取关于任意店铺的评论和评分之类的。给出破解css加密的方法

**大众点评的评论页面的话目前有两种不同的页面，一种是店铺下的评论（例：http://www.dianping.com/shop/1541380745 ），另外一种是店铺详细的评论（例：http://www.dianping.com/shop/1541380745/review_all/p2 ），两者的区别是后缀不同。**

刚开始弄这个大众点评的评论的时候其实是遇到了很多坑的，这是我第一次遇到有难度的反爬机制，以前的其实只是限制ip啊什么的就比较简单，这次的话用了加密来进行反爬，不知道方法的话就比较头疼。大众点评里面使用的主要是css加密算法，这里的话就不多介绍css加密算法的原理什么的，我们的主要目的是直接获取大众点评的评论代码嘛，所以关于这个css加密是怎么实现的，大家可以参考别的博客进行查询。附上我进行参考的几个链接： 
https://blog.csdn.net/Obgo_6/article/details/100585363  
https://blog.csdn.net/weixin_42512684/article/details/86775357  
https://blog.csdn.net/sinat_32651363/article/details/85123876

爬虫和反爬其实是一个斗智斗勇的过程，所以大众点评的反爬也在不断更新，不过上面说的第一个评论页面（即没有后缀的那个url例子）在查询源代码的时候已经看不到评论了，所以我这里的第一个方法应该是用不了了，当然啦，理论上还是可以爬的。第二个评论页面（有后缀的那个url例子）在这里的话我的这个爬虫目前（2020.4.7）还是有效的，但是过一些日子就不清楚了。

**1. 这里先介绍第一个没有后缀的评论的爬取方法（虽然这个好像被禁掉了……）**
以http://www.dianping.com/shop/1541380745 这个url为例子，打开之后F12分析源代码，里面有一个url是以's3c'开头的一个url，打开这个url，你会发现里面是很多的.eof文件和.woff文件，这里面其实就是css加密的转换对应表，在使用百度的在线字体可视化工具打开之后，可以看到里面的一个对应的情况的。在这里我自己的操作是先将这些.woff文件通过TFFont转化成.xml文件，然后再xml的parse定位构建字典，从而建立对应表（项目里称为密码表），**注意，这个对应表是会随时更新的，而且每次更新都会有几个文件，所以每次运行的时候要先查询这些文件有没有更新**，建立对应表之后，缓存，然后因为一次的运行的时候s3c那个链接里会有多个.woff文件，所以会有多个对应表，需要通过测试找到真正的是哪个对应表，再通过替换，将评论里面缺失的字进行替换就可以获取到实际的评论了。

对于这个真正的对应表，应该在s3c的url里或者是评论的url里应该还是有线索的，感兴趣的小伙伴可以看看。

文件结构

> 破解密码表.py : 构建对应表  
> 密码表缓存.py : 存储对应表  
> 主页.py : 进行评论获取  


